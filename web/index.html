

<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->

<!--    <base href="$FLUTTER_BASE_HREF">-->

<!--    <meta charset="UTF-8">-->
<!--    <meta content="IE=Edge" http-equiv="X-UA-Compatible">-->
<!--    <meta name="description" content="Trainer Section Web App">-->

<!--    &lt;!&ndash; iOS meta tags & icons &ndash;&gt;-->
<!--    <meta name="mobile-web-app-capable" content="yes">-->
<!--    <meta name="apple-mobile-web-app-status-bar-style" content="black">-->
<!--    <meta name="apple-mobile-web-app-title" content="trainer_section">-->
<!--    <link rel="apple-touch-icon" href="icons/Icon-192.png">-->

<!--    &lt;!&ndash; Favicon &ndash;&gt;-->
<!--    <link rel="icon" type="image/png" href="favicon.png"/>-->

<!--    <title>Trainer Section</title>-->
<!--    <link rel="manifest" href="manifest.json">-->
<!--</head>-->
<!--<body>-->

<!--&lt;!&ndash; ===== Firebase & FCM initialization ===== &ndash;&gt;-->
<!--<script type="module">-->
<!--    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";-->
<!--    import {-->
<!--      getMessaging,-->
<!--      getToken,-->
<!--      deleteToken,-->
<!--      onMessage-->
<!--    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-messaging.js";-->


<!--    const firebaseConfig = {-->
<!--      apiKey: "AIzaSyBrBrrP8RmHbdj0CA9aXhonShhB10k0ryo",-->
<!--      authDomain: "graduationproject-3d3b0.firebaseapp.com",-->
<!--      projectId: "graduationproject-3d3b0",-->
<!--      storageBucket: "graduationproject-3d3b0.firebasestorage.app",-->
<!--      messagingSenderId: "425903761784",-->
<!--      appId: "1:425903761784:web:ce5370b117d9b6a78f808d"-->
<!--    };-->

<!--    //  Firebase App و Messaging-->
<!--    const app = initializeApp(firebaseConfig);-->
<!--    const messaging = getMessaging(app);-->

<!--    (async () => {-->
<!--      // 1) تسجيل Service Worker-->
<!--      if (!('serviceWorker' in navigator)) {-->
<!--        console.error('🚫 هذا المتصفح لا يدعم Service Workers');-->
<!--        return;-->
<!--      }-->
<!--      const reg = await navigator.serviceWorker.register('firebase-messaging-sw.js');-->
<!--      console.log('✅ Service Worker مسجّل:', reg);-->

<!--      // 2) طلب إذن الإشعارات-->
<!--      const perm = await Notification.requestPermission();-->
<!--      if (perm !== 'granted') {-->
<!--        console.error('🚫 تم رفض إذن الإشعارات');-->
<!--        return;-->
<!--      }-->

<!--      // 3) تأخير بسيط للتأكد من تثبيت الـ SW-->
<!--      await new Promise(res => setTimeout(res, 500));-->

<!--      // 4) حذف أي توكن FCM قديم (اختياري لكن يحل مشاكل الاشتراك المزدوج)-->
<!--      try {-->
<!--        await deleteToken(messaging);-->
<!--        console.log('🗑️ تم حذف FCM token القديم');-->
<!--      } catch (e) {-->
<!--        console.warn('⚠️ لا يوجد FCM token قديم للحذف أو حدث خطأ:', e);-->
<!--      }-->

<!--      // 5) جلب التوكن الجديد وتمرير Service Worker registration-->
<!--      const currentToken = await getToken(messaging, {-->
<!--        vapidKey: 'BMUIu0ik_OZJ9r9n3GPXib5fouwP02aKUqHBPJZFio406nmC_henlk7OtEco9fc5xd7Q3q_tZM0RuP6oBBPqTPc',-->
<!--        serviceWorkerRegistration: reg-->
<!--      });-->
<!--      console.log('🔑 FCM Token:', currentToken);-->
<!--      // TODO: أرسل هذا التوكن إلى الـ backend لحفظه تحت المستخدم-->

<!--      // 6) استماع للرسائل أثناء الـ foreground-->
<!--      onMessage(messaging, payload => {-->
<!--        console.log('📬 رسالة واردة (foreground):', payload);-->
<!--        // مثال: عرض SnackBar أو Notification API هنا-->
<!--      });-->
<!--    })().catch(err => console.error('Firebase init error:', err));-->
<!--</script>-->

<!--&lt;!&ndash; ===== Flutter web bootstrap ===== &ndash;&gt;-->
<!--<script src="flutter_bootstrap.js" async></script>-->
<!--</body>-->
<!--</html>-->












<!DOCTYPE html>
<html>
<head>
    <base href="$FLUTTER_BASE_HREF">
    <meta charset="UTF-8">
    <title>Trainer Section</title>
    <link rel="manifest" href="manifest.json">
</head>
<body>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { isSupported } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-messaging.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBrBrrP8RmHbdj0CA9aXhonShhB10k0ryo",
      authDomain: "graduationproject-3d3b0.firebaseapp.com",
      projectId: "graduationproject-3d3b0",
      storageBucket: "graduationproject-3d3b0.firebasestorage.app",
      messagingSenderId: "425903761784",
      appId: "1:425903761784:web:ce5370b117d9b6a78f808d"
    };

    // Firebase init
    const app = initializeApp(firebaseConfig);

    (async () => {
      const supported = await isSupported();
      console.log("isSupported:", supported);
      if (!supported) return;

      if (!('serviceWorker' in navigator)) {
        console.error("🚫 المتصفّح لا يدعم Service Workers");
        return;
      }

      // ✅ سجّل الـ SW بمسار مطلق لضمان الـ scope من الجذر
      const reg = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
      console.log("✅ SW registered. scope:", reg.scope);

      // ✅ انتظر حتى يصبح SW جاهزًا
      await navigator.serviceWorker.ready;

      // ✅ اطلب إذن الإشعارات فقط (بدون getToken هنا)
      const perm = await Notification.requestPermission();
      console.log("Notification permission:", perm);
    })().catch(e => console.error("Firebase init failed:", e));
</script>

<script src="flutter_bootstrap.js" async></script>
</body>
</html>
